---
title: 利用GitHub Actions自动对仓库内图片进行无损压缩
date: 2022-08-01 23:42:32
permalink: /pages/dbee9e/
categories:
  - 运维观止
  - GitHub
tags:
  -
titleTag: 原创
feed:
  enable: true
description: 我维护的 awesome-github-profile-readme-chinese 项目旨在收集汇总中文区优秀的个人主页，每个人的主页将会通过截图的方式存放在 exampls 目录下，有时候有的朋友主页内容很多，这样整体截图下来就非常大。本文就介绍一个有意思的小动作，它的主要功能是可以自动扫描仓库内的图片，然后对其进行几乎无损的压缩，让整个仓库的体积保持在一个相对低的水平。
---


我维护的 [awesome-github-profile-readme-chinese](https://github.com/eryajf/awesome-github-profile-readme-chinese) 项目旨在收集汇总中文区优秀的个人主页，每个人的主页将会通过截图的方式存放在 exampls 目录下，有时候有的朋友主页内容很多，这样整体截图下来就非常大。

本文就介绍一个有意思的小动作，它的主要功能是可以自动扫描仓库内的图片，然后对其进行几乎无损的压缩，让整个仓库的体积保持在一个相对低的水平。

所用Actions：[image-actions](https://github.com/calibreapp/image-actions)

使用配置其实非常简单，基本上阅读完官方介绍文档就可以上手使用了，这里说一两个需要注意的地方。

首先添加Actions配置文件，e.g. `.github/workflows/images.yml`：

```yml
name: 压缩图片
on:
  pull_request:
    paths:
      - '**.jpg'
      - '**.jpeg'
      - '**.png'
      - '**.webp'
  workflow_dispatch:
jobs:
  build:
    if: github.event.pull_request.head.repo.full_name == github.repository
    name: calibreapp/image-actions
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v2

      - name: Compress Images
        uses: calibreapp/image-actions@main
        with:
          githubToken: ${{ secrets.ACCESS_TOKEN }}
          jpegQuality: '60'
          jpegProgressive: false
          pngQuality: '60'
          webpQuality: '60'
```

配置文件中用到了 `ACCESS_TOKEN`，我的这篇文章有详细介绍如何生成以及配置，可直接参考： [https://wiki.eryajf.net/pages/47a507/](https://wiki.eryajf.net/pages/47a507/)。

因为项目中的图片都是通过其他开发者协作提交上来，因此配置的触发条件就是pull_request，其他的基本上都是官方提供的配置信息，详细配置可看官方介绍。


效果如下：

![](http://t.eryajf.net/imgs/2022/08/1fa538021f1f5631.png)

这个动作会自动将图片处理好，然后提交到当次PR上，我们可以点开 View diff查看前后的区别：

![](http://t.eryajf.net/imgs/2022/08/92fefdc809ad227d.png)

目前这个效果据我个人放大前后两张照片来看，在体积缩小了80%的情况下，清晰度几乎是一致的，还是非常给力的一个动作，适合那些存放图片比较多的仓库。